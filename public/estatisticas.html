<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estatísticas - Vibrações 48ª EAE Online</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f6f9; margin: 0; padding: 25px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #333; }
        .cards-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background-color: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; }
        .card .numero { font-size: 2.5em; font-weight: bold; color: #007bff; margin: 0; }
        .card .legenda { font-size: 1.1em; color: #666; margin-top: 5px; }
        .grafico-container { background-color: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div id="main-content" class="container">
        <h1>Estatísticas do Trabalho de Vibrações</h1>
        <div class="cards-container">
            <div class="card">
                <p id="total-ativos" class="numero">...</p>
                <p class="legenda">Nomes Ativos no Painel</p>
            </div>
            <div class="card">
                <p id="pedidos-hoje" class="numero">...</p>
                <p class="legenda">Pedidos Recebidos Hoje</p>
            </div>
        </div>
        <div class="grafico-container">
            <h2>Pedidos por Mês (Últimos 6 Meses)</h2>
            <canvas id="grafico-mensal"></canvas>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // ===================================================================
        //      COLE AQUI AS NOVAS CHAVES DE CONFIGURAÇÃO DO FIREBASE
        // ===================================================================
        const firebaseConfig = {
  apiKey: "AIzaSyBuYdERX224x0dzWtFH0mi__oVH3DxsmP0",
  authDomain: "vibracoes-cede.firebaseapp.com",
  projectId: "vibracoes-cede",
  storageBucket: "vibracoes-cede.firebasestorage.app",
  messagingSenderId: "1081610853181",
  appId: "1:1081610853181:web:b10eb65f1506d141684354"
};
        // ===================================================================

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function carregarEstatisticas() {
            try {
                // Lê o único documento que o robô preparou para nós
                const docRef = doc(db, "estatisticas", "resumo");
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const dados = docSnap.data();

                    // Preenche os cartões
                    document.getElementById('total-ativos').textContent = dados.totalAtivos || 0;
                    document.getElementById('pedidos-hoje').textContent = dados.pedidosHoje || 0;
                    
                    // Prepara os dados para o gráfico
                    const labels = dados.pedidosPorMes.map(item => item.mes);
                    const dataPoints = dados.pedidosPorMes.map(item => item.total);

                    // Cria o gráfico
                    new Chart(document.getElementById('grafico-mensal'), {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Total de Pedidos',
                                data: dataPoints,
                                backgroundColor: 'rgba(0, 123, 255, 0.5)',
                                borderColor: 'rgba(0, 123, 255, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: { scales: { y: { beginAtZero: true } } }
                    });

                } else {
                    console.log("Documento de estatísticas ainda não foi criado pelo robô.");
                    document.getElementById('total-ativos').textContent = "N/A";
                    document.getElementById('pedidos-hoje').textContent = "N/A";
                }
            } catch (error) {
                console.error("Erro ao carregar estatísticas:", error);
            }
        }

        carregarEstatisticas();
    </script>
</body>
</html>